	public static byte[] rawExecute(String str, Repository db)
			throws Exception {
		String[] args = split(str);
		if (!args[0].equalsIgnoreCase("git") || args.length < 2)
			throw new IllegalArgumentException(
					"Expected 'git <command> [<args>]', was:" + str);
		String[] argv = new String[args.length - 1];
		System.arraycopy(args, 1, argv, 0, args.length - 1);

		CLIGitCommand bean = new CLIGitCommand();
		final CmdLineParser clp = new TestCmdLineParser(bean);
		clp.parseArgument(argv);

		final TextBuiltin cmd = bean.getSubcommand();
		ByteArrayOutputStream baos = new ByteArrayOutputStream();
		cmd.outs = baos;
		ByteArrayOutputStream errs = new ByteArrayOutputStream();
		cmd.errs = errs;
		boolean seenHelp = TextBuiltin.containsHelp(argv);
		if (cmd.requiresRepository())
			cmd.init(db, null);
		else
			cmd.init(null, null);
		try {
			cmd.execute(bean.getArguments().toArray(
					new String[bean.getArguments().size()]));
		} catch (TerminatedByHelpException e) {
			seenHelp = true;
			// this is not a failure, command execution should just not happen
		} finally {
			if (cmd.outw != null) {
				cmd.outw.flush();
			}
			if (cmd.errw != null) {
				cmd.errw.flush();
			}
			if (seenHelp) {
				return errs.toByteArray();
			} else if (errs.size() > 0) {
				// forward the errors to the standard err
				System.err.print(errs.toString());
			}
		}
		return baos.toByteArray();
	}

