	@Override
	public void materialize(final WindowCursor curs) throws IOException {
		if (cachedBytes != null) {
			return;
		}

		if (objectType != OBJ_COMMIT) {
			final UnpackedObjectCache.Entry cache = pack.readCache(dataOffset);
			if (cache != null) {
				curs.release();
				cachedBytes = cache.data;
				return;
			}
		}

		try {
			cachedBytes = pack.decompress(dataOffset, objectSize, curs);
			curs.release();
			if (objectType != OBJ_COMMIT)
				pack.saveCache(dataOffset, cachedBytes, objectType);
		} catch (DataFormatException dfe) {
			final CorruptObjectException coe;
			coe = new CorruptObjectException("Object at " + dataOffset + " in "
					+ pack.getPackFile() + " has bad zlib stream");
			coe.initCause(dfe);
			throw coe;
		}
	}

