	@Override
	public void materialize(final WindowCursor curs) throws IOException {
		if (cachedBytes != null) {
			return;
		}

		if (objectType != OBJ_COMMIT) {
			UnpackedObjectCache.Entry cache = pack.readCache(objectOffset);
			if (cache != null) {
				curs.release();
				cachedBytes = cache.data;
				return;
			}
		}

		try {
			cachedBytes = pack.decompress(objectOffset + headerSize,
					objectSize, curs);
			curs.release();
			if (objectType != OBJ_COMMIT)
				pack.saveCache(objectOffset, cachedBytes, objectType);
		} catch (DataFormatException dfe) {
			final CorruptObjectException coe;
			coe = new CorruptObjectException(MessageFormat.format(JGitText.get().objectAtHasBadZlibStream,
					objectOffset, pack.getPackFile()));
			coe.initCause(dfe);
			throw coe;
		}
	}

