		byte[] finishPack() throws IOException {
			// Overwrite placeholder header with actual object count, then hash.
			file.seek(0);
			write(hdrBuf, 0, writePackHeader(hdrBuf, objectList.size()));

			byte[] buf = buffer();
			SHA1 md = digest().reset();
			file.seek(0);
			while (true) {
				int r = file.read(buf);
				if (r < 0) {
					break;
				}
				md.update(buf, 0, r);
			}
			byte[] packHash = md.digest();
			out.write(packHash, 0, packHash.length);
			return packHash;
		}

