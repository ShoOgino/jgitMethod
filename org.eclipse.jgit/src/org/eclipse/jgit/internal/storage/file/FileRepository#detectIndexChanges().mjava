	/** Detect index changes. */
	private void detectIndexChanges() {
		if (isBare()) {
			return;
		}

		File indexFile = getIndexFile();
		snapshotLock.lock();
		try {
			if (snapshot == null) {
				snapshot = FileSnapshot.save(indexFile);
			} else if (snapshot.isModified(indexFile)) {
				snapshotLock.unlock();
				notifyIndexChanged(false);
			}
		} finally {
			if (snapshotLock.isHeldByCurrentThread()) {
				snapshotLock.unlock();
			}
		}
	}

