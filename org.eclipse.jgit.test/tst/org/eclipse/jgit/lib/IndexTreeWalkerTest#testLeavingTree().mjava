	public void testLeavingTree() throws IOException {
		GitIndex index = new GitIndex(db);
		index.add(trash, writeTrashFile("foo/bar", "foo/bar"));
		index.add(trash, writeTrashFile("foobar", "foobar"));

		new IndexTreeWalker(index, db.mapTree(index.writeTree()), trash, new AbstractIndexTreeVisitor() {
			@Override
			public void visitEntry(TreeEntry entry, Entry indexEntry, File f) {
				if (entry == null || indexEntry == null)
					fail();
			}

			@Override
			public void finishVisitTree(Tree tree, int i, String curDir)
					throws IOException {
				if (tree.memberCount() == 0)
					fail();
				if (i == 0)
					fail();
			}

		}).walk();
	}

