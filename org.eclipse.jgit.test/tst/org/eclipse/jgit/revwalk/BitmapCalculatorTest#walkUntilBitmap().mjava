	@Test
	public void walkUntilBitmap() throws Exception {
		RevCommit root = repo.commit().create();
		repo.update("refs/heads/master", root);

		// GC creates bitmap index with ALL objects
		GC gc = new GC(repo.getRepository());
		gc.setAuto(false);
		gc.gc();

		// These objects are not in the bitmap index.
		RevCommit commit1 = repo.commit(root);
		RevCommit commit2 = repo.commit(commit1);
		repo.update("refs/heads/master", commit2);

		CounterProgressMonitor monitor = new CounterProgressMonitor();
		BitmapCalculator bitmapWalker = new BitmapCalculator(repo.getRevWalk());
		BitmapBuilder bitmap = bitmapWalker.getBitmap(commit2, monitor);

		assertTrue(bitmap.contains(root));
		assertTrue(bitmap.contains(commit1));
		assertTrue(bitmap.contains(commit2));
		assertEquals(2, monitor.getUpdates());
	}

