	public void testGetEntriesAddDeleteModify() throws Exception {
		ObjectId foo = testDb.blob("foo").copy();
		ObjectId bar = testDb.blob("bar").copy();

		DiffEntry a = new DiffEntry();
		a.newId = AbbreviatedObjectId.fromObjectId(foo);
		a.newMode = FileMode.REGULAR_FILE;
		a.newName = "some/file.c";
		a.changeType = ChangeType.ADD;

		DiffEntry b = new DiffEntry();
		b.oldId = AbbreviatedObjectId.fromObjectId(foo);
		b.oldMode = FileMode.REGULAR_FILE;
		b.oldName = "some/other_file.c";
		b.changeType = ChangeType.DELETE;

		DiffEntry c = new DiffEntry();
		c.newId = c.oldId = AbbreviatedObjectId.fromObjectId(bar);
		c.newMode = c.oldMode = FileMode.REGULAR_FILE;
		c.newName = c.oldName = "some/header.h";
		c.changeType = ChangeType.MODIFY;

		rd.addDiffEntry(a);
		rd.addDiffEntry(b);
		rd.addDiffEntry(c);

		List<DiffEntry> entries = rd.getEntries();
		assertEquals(2, entries.size());

		// The renamed change should be first because the output should be
		// sorted by newName
		DiffEntry rename = entries.get(0);
		assertNotNull(rename);
		assertTrue(foo.equals(rename.newId.toObjectId()));
		assertTrue(foo.equals(rename.oldId.toObjectId()));
		assertEquals(FileMode.REGULAR_FILE, rename.newMode);
		assertEquals(FileMode.REGULAR_FILE, rename.oldMode);
		assertEquals(ChangeType.RENAME, rename.changeType);
		assertEquals("some/file.c", rename.newName);
		assertEquals("some/other_file.c", rename.oldName);

		DiffEntry modify = entries.get(1);
		assertEquals(c, modify);
	}

