	public void setupRepository() throws IOException, JGitInternalException,
			GitAPIException {

		// create initial commit
		git = new Git(db);
		initialCommit = git.commit().setMessage("initial commit").call();

		// create nested file
		File dir = new File(db.getWorkTree(), "dir");
		FileUtils.mkdir(dir);
		File nestedFile = new File(dir, "b.txt");
		FileUtils.createNewFile(nestedFile);

		try (PrintWriter nestedFileWriter = new PrintWriter(nestedFile)) {
			nestedFileWriter.print("content");
			nestedFileWriter.flush();

			// create file
			indexFile = new File(db.getWorkTree(), "a.txt");
			FileUtils.createNewFile(indexFile);
			try (PrintWriter writer = new PrintWriter(indexFile)) {
				writer.print("content");
				writer.flush();

				// add file and commit it
				git.add().addFilepattern("dir").addFilepattern("a.txt").call();
				secondCommit = git.commit()
						.setMessage("adding a.txt and dir/b.txt").call();

				prestage = DirCache.read(db.getIndexFile(), db.getFS())
						.getEntry(indexFile.getName());

				// modify file and add to index
				writer.print("new content");
			}
			nestedFileWriter.print("new content");
		}
		git.add().addFilepattern("a.txt").addFilepattern("dir").call();

		// create a file not added to the index
		untrackedFile = new File(db.getWorkTree(),
				"notAddedToIndex.txt");
		FileUtils.createNewFile(untrackedFile);
		try (PrintWriter writer2 = new PrintWriter(untrackedFile)) {
			writer2.print("content");
		}
	}

