	@Test
	public void testIsModifiedSymlinkAsFile() throws Exception {
		File f = writeTrashFile("symlink", "content");
		Git git = new Git(db);
		db.getConfig().setString(ConfigConstants.CONFIG_CORE_SECTION, null,
				ConfigConstants.CONFIG_KEY_SYMLINKS, "false");
		git.add().addFilepattern("symlink").call();
		git.commit().setMessage("commit").call();

		// Modify previously committed DirCacheEntry and write it back to disk
		DirCacheEntry dce = db.readDirCache().getEntry("symlink");
		dce.setFileMode(FileMode.SYMLINK);
		DirCacheCheckout.checkoutEntry(db, f, dce);

		FileTreeIterator fti = new FileTreeIterator(trash, db.getFS(), db
				.getConfig().get(WorkingTreeOptions.KEY));
		while (!fti.getEntryPathString().equals("symlink"))
			fti.next(1);
		ObjectReader objectReader = db.newObjectReader();
		assertFalse(fti.isModified(dce, false, objectReader));
		objectReader.release();
	}

