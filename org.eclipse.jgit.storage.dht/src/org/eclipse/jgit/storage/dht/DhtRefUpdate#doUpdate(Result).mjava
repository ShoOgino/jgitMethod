	@Override
	protected Result doUpdate(Result desiredResult) throws IOException {
		try {
			newData = newData();
			boolean r = db.ref().compareAndPut(refKey, oldData, newData);
			if (r) {
				getRefDatabase().stored(dstRef.getName(), newData);
				return desiredResult;
			} else {
				getRefDatabase().clearCache();
				return Result.LOCK_FAILURE;
			}
		} catch (TimeoutException e) {
			return Result.IO_FAILURE;
		}
	}

