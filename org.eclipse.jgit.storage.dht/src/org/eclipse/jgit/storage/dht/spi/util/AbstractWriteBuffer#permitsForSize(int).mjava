	private int permitsForSize(int size) {
		// Do not acquire more than the configured buffer size,
		// even if the actual write size is larger. Trying to
		// acquire more would never succeed.

		if (size <= 0)
			size = 1;
		return Math.min(size, bufferSize);
	}

