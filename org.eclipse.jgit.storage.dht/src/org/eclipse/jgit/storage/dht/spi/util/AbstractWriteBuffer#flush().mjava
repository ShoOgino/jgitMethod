	public void flush() throws DhtException {
		try {
			flushing = true;

			if (0 < queuedCount) {
				startQueuedOperations(queuedCount);
				queuedCount = 0;
			}

			// If a task was created above, try to use the current thread
			// instead of burning an executor thread for the final work.

			if (finalTask != null) {
				try {
					waitFor(finalTask);
				} finally {
					finalTask = null;
				}
			}

			checkRunningTasks(true);
		} finally {
			flushing = false;
		}
	}

