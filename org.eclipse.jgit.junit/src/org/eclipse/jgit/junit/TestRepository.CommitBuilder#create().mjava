		public RevCommit create() throws Exception {
			if (self == null) {
				TestRepository.this.tick(tick);

				final Commit c = new Commit(db);
				c.setParentIds(parents.toArray(new RevCommit[parents.size()]));
				c.setAuthor(new PersonIdent(author, new Date(now)));
				c.setCommitter(new PersonIdent(committer, new Date(now)));
				c.setMessage(message);

				ObjectId commitId;
				try {
					c.setTreeId(tree.writeTree(inserter));
					commitId = inserter.insert(Constants.OBJ_COMMIT, inserter
							.format(c));
					inserter.flush();
				} finally {
					inserter.release();
				}
				self = pool.lookupCommit(commitId);

				if (branch != null)
					branch.update(self);
			}
			return self;
		}

